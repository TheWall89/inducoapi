![pytest](https://github.com/TheWall89/json2openapi/workflows/pytest/badge.svg?branch=master&event=push)

# json2openapi

A simple python program to generate OpenApi documentation by supplying request/response bodies.

## Motivation

Sometimes you have a fully functioning HTTP service without OpenAPI specification.
At some point in time, others may need to use your service.
Writing the specification by hand is a pain and can feel like an overwhelming job for complex services.
_json2openapi_ helps you generate your OpenApi specification by taking as input request/response examples plus some
other information.

The generated OpenApi specification is validated with [openapi3](https://github.com/Dorthu/openapi3).

_Warning_: This program also generates the `example` fields in OpenApi schemas by default.
If you have sensible data in your request/response files, disable this feature with `--no-example`.

## Installation

We use [poetry](https://python-poetry.org/) for dependency management.

```shell script
# clone repository
cd json2openapi
poetry install --no-root
```

## Usage

### From python

[test_json2openapi.py](tests/test_json2openapi.py) provides usage examples of the module from python.

### From CLI
`json2openapi.py` provides its own help. Check it out with:

```shell script
poetry run json2openapi/json2openapi.py --help
```

Let's consider a simple case: you have an HTTP service managing employees.
We want to generate OpenApi spec for a GET on all the employees, returning a 200 status code:

```shell script
poetry run json2openapi/json2openapi.py GET /employees 200
```

<details><summary>output</summary>

```yaml
openapi: 3.0.0
info:
  title: Generated by json2openapi
  version: v1
paths:
  /employees:
    get:
      responses:
        200:
          description: ''
```

</details>

Now, a GET request with an empty response is not quite useful.
Let's add an argument with a JSON file containing a response example.
Input examples can be found in [examples](examples).

```shell script
poetry run json2openapi/json2openapi.py GET /employees 200 --response examples/employees.json
```

<details><summary>output</summary>

```yaml
openapi: 3.0.0
info:
  title: Generated by json2openapi
  version: v1
paths:
  /employees:
    get:
      responses:
        200:
          description: ''
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: integer
                      example: 1
                    name:
                      type: string
                      example: Dwight Schrute
                    role:
                      type: string
                      example: salesman
```

</details>

Finally, let's try a POST request with both request and response.

```shell script
poetry run json2openapi/json2openapi.py POST /employees 201 --request examples/new_employee_req.json --response examples/new_employee_resp.json
```

<details><summary>output</summary>

```yaml
openapi: 3.0.0
info:
  title: Generated by json2openapi
  version: v1
paths:
  /employees:
    post:
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  example: Michael Scott
                role:
                  type: string
                  example: manager
      responses:
        201:
          description: ''
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                    example: 4
                  name:
                    type: string
                    example: Michael Scott
                  role:
                    type: string
                    example: manager
```

</details>

If you want to directly write the generated OpenApi spec in a YAML file, just add `--output openapi.yaml`

## TODO list

- [x] Add support for request/response files in YAML
- [x] Add support for `application/yaml` content
- [ ] Package module
- [ ] Add support for `headers`
- [ ] Add support for `links`
- [ ] Add support for `format`
- [ ] Add an integrated HTTP client to get responses from the service
